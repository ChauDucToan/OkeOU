{% extends 'layout/base.html' %}

{% block title %}
Orders
{% endblock %}

{% block content %}
<div class="container flex-grow-1">
    <div class="fw-bold m-3 p-3 fs-4">
        Đặt dịch vụ (
        <span class="text-white-50 order-counter"> {{ stats_order.total_quantity }} </span>
        <span class="text-white-50">dịch vụ </span>
        )
    </div>

    {% if 'order' in session %}

    <div class="d-flex gap-3 m-3">
        <div style="width:75%" class="glass-panel text-white">
            <table class="table align-middle table-glass">
                <thead class="table-light">
                <tr>
                    <th>Dịch vụ</th>
                    <th>SL còn lại</th>
                    <th>Giá tiền</th>
                    <th class="text-center">Số lượng</th>
                    <th>Thành tiền</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for o in session['order'].values() %}
                <tr id="cart{{ o.id }}">
                    <td>
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <img src="{{ o.image }}" alt="..." style="width:90px; height:90px; object-fit:cover;">
                            </div>
                            <div class="flex-grow-1 ms-3">
                                {{ o.name }}
                            </div>
                        </div>
                    </td>
                    <td>{{ o.amount }}</td>
                    <td>{{ '{:,.0f}'.format(o.price) }}</td>
                    <td class="text-center">
                        <input type="number"
                            value="{{ o.quantity }}"
                            class="form-control form-control-sm mx-auto"
                            style="width:70px"
                            min="1"
                            max="30"
                            oninput="limitQuantity(this)"
                            onblur="updateOrder({{ o.id }}, this)">
                    </td>
                    <td class="order-product-amount" data-price="{{ o.price }}">{{ '{:,.0f}'.format(o.price * o.quantity) }}</td>
                    <td class="text-center">
                        <button class="btn btn-outline-danger btn-sm"
                                onclick="deleteOrder({{ o.id }})">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <a class="p-3 fs-5 text-decoration-none btn btn-glass active mt-4" href="/products">
                <i class="bi bi-box-arrow-in-left"></i>
                Tiếp tục đặt dịch vụ
            </a>
        </div>

        <div class="p-3 w-25 border rounded">
            <div class="fw-bold mb-2">Tổng tiền dịch vụ</div>

            <div>
                <div class="d-flex justify-content-between py-2">
                    <span>Tạm tính:</span>
                    <span class="order-amount">{{ '{:,.0f}'.format(stats_order.total_amount) }} VND</span>
                </div>

                <div class="d-flex justify-content-between py-2">
                    <span>Giảm giá:</span>
                    <span>0 VND</span>
                </div>

                <hr>

                <div class="d-flex justify-content-between fw-bold py-2">
                    <span>Tổng cộng:</span>
                    <span class="order-amount">{{ '{:,.0f}'.format(stats_order.total_amount) }} VND</span>
                </div>
                {% if current_user.is_authenticated %}
                <button class="btn btn-primary w-100 mt-2" type="button" onclick="orderProcess()">
                    Tiến hành đặt
                </button>
                {% else %}
                <div>
                    Vui lòng <a href="/login?next=/orders">đăng nhập</a> để thanh toán
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center m-3 p-3">
        <div class="mb-3 fs-1 text-secondary">
            <i class="bi bi-bag-plus"></i>
        </div>
        <p class="fs-5">Chưa có dịch vụ được đặt</p>
        <a href="/products"><button class="btn btn-primary px-4" type="button">Tiếp tục đặt dịch vụ</button></a>

    </div>
    {% endif %}
</div>
<script src="{{ url_for('static', filename='js/orders.js') }}"></script>
{% endblock %}