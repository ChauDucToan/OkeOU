{% extends 'admin/master.html' %}

{% block body %}

{% if current_user.is_authenticated and current_user.is_admin %}
<h1 class="text-center text-success">Tổng quan hệ thống</h1>

<div class="row mt-4">
	<div class="col-md-5 col-6">
		<div class="list-group">
			<a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
				Số phòng hiện có
				<div class="align-items-center m-2">
					<span class="alert alert-primary w-100">{{ stats.rooms }}</span>
				</div>
			</a>
			<a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
				Số sản phẩm hiện có
				<div class="align-items-center m-2">
					<span class="alert alert-primary w-100">{{ stats.products }}</span>
				</div>
			</a>
			<a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
				Số nhân viên hiện có
				<div class="align-items-center m-2">
					<span class="alert alert-primary w-100">{{ stats.staff }}</span>
				</div>
			</a>
		</div>
	</div>
	<div class="col-md-7 col-6">
		<h3 class="text-center text-success">Thống kê doanh thu theo tháng</h3>
		<canvas id="monthlyRevenue"></canvas>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
	function drawChart(ctx, labels, data) {
		new Chart(ctx, {
		type: 'pie',
		data: {
			labels: labels,
			datasets: [{
				label: '# Doanh thu',
				data: data,
				borderWidth: 1,
				backgroundColor: ['red', 'green', 'blue', 'gold', 'brown', 'pink']
			}]
		},
		options: {
			scales: {
				y: {
					beginAtZero: true
				}
			}
		}
	});
	}

	window.onload = function() {
		let labels = [];
		let data = [];

		{% for s in cate_stats %}
		labels.push('{{s[1]}}');
		data.push({{s[2]}});
		{% endfor %}

		const ctx = document.getElementById('monthlyRevenue');
		drawChart(ctx, labels, data);
	}
</script>

{% else %}
<h2 class="text-success text-center">ĐĂNG NHẬP QUẢN TRỊ</h2>

<form method="post" action="/login?next=/admin">
	<div class="form-group">
		<label for="name">Tên đăng nhập:</label>
		<input type="text" class="form-control" placeholder="Tên đăng nhập" id="name" name="username" required />
	</div>
	<div class="form-group">
		<label for="pwd">Mật khẩu:</label>
		<input type="password" class="form-control" placeholder="Mật khẩu" id="pwd" name="password" required />
	</div>
	<button type="submit" class="btn btn-primary">Đăng nhập</button>
</form>
{% endif %}

{% endblock %}