{% extends 'admin/master.html' %}

{% block body %}

{% if current_user.is_authenticated and current_user.is_admin %}
<h1 class="text-center text-success">Kiểm tra hệ thống</h1>
<div class="row">
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3 h-100">
            <div class="card-header">Đơn hàng đang chờ xử lý</div>
            <div class="card-body">
                <h5 class="card-title">{{ pending_count }}</h5>
                <p class="card-text">Số đơn hàng đang chờ xử lý trong hệ thống.</p>
                <button onclick="servedAll()" class="btn btn-light">Chuyển thành served</button>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3 h-100">
            <div class="card-header">Các phiên hát đang hoạt động</div>
            <div class="card-body">
                <h5 class="card-title">{{ active_session }}</h5>
                <p class="card-text">Phiên làm việc đang hoạt động trong hệ thống.</p>
                <a href="{{ url_for('staff_preview') }}" class="btn btn-light">Kiểm tra chi tiết</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3 h-100">
            <div class="card-header">Số lượng nhân viên</div>
            <div class="card-body">
                <h5 class="card-title">{{ staff_today }}</h5>
                <p class="card-text">Số lượng nhân viên làm trong ngày.</p>
                <a href="/admin/staff/" class="btn btn-light">Kiểm tra chi tiết</a>
            </div>
        </div>
    </div>
</div>
<hr/>
<h1 class="text-center text-success">Báo cáo</h1>
<div class="p-4 bg-secondary rounded shadow-sm">
    <div class="d-flex align-items-baseline mb-2">
        <h5 class="fs-4 fw-bold text-white mb-0 me-2">Báo cáo Doanh thu -</h5>
        <span class="pl-1 text-white small">Báo cáo doanh thu theo</span>
    </div>
    <hr class="mt-0"/>
    <div class="row g-3 mb-4">
        {% for period in ['day', 'week', 'month', 'year'] %}
        <div class="col-3">
            <a
                    href="{{ url_for('admin.time_stats', period=period) }}"
                    class="card shadow-sm text-decoration-none bg-secondary text-white"
                    onclick=""
            >
                <div class="card-body text-center p-3">
                    <span class="fw-bold text-uppercase">{{ period }}</span>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>
<hr/>
<h1 class="text-center text-success">Leaderboard</h1>
<div class="container-fluid mb-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="panel shadow-sm mb-3">
                <div class="panel-heading bg-secondary text-white p-1 rounded-top">
                    <h3 class="panel-title text-center">Top 20 Nhân Viên Xuất Sắc Nhất</h3>
                </div>
                <div class="panel-body" style="max-height: 500px; overflow-y: scroll;">
                    <ul class="list-group list-group-flush">
                        {% for name, total_hours in top_employees %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                
                                <div class="employee-info">
                                    <span class="badge rank-badge">#{{ loop.index }}</span>
                                    <span class="emp-name">{{ name }}</span>
                                    
                                    {% if loop.index == 1 %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trophy-fill text-warning" viewBox="0 0 16 16">
                                        <path d="M2.5.5A.5.5 0 0 1 3 0h10a.5.5 0 0 1 .5.5q0 .807-.034 1.536a3 3 0 1 1-1.133 5.89c-.79 1.865-1.878 2.777-2.833 3.011v2.173l1.425.356c.194.048.377.135.537.255L13.3 15.1a.5.5 0 0 1-.3.9H3a.5.5 0 0 1-.3-.9l1.838-1.379c.16-.12.343-.207.537-.255L6.5 13.11v-2.173c-.955-.234-2.043-1.146-2.833-3.012a3 3 0 1 1-1.132-5.89A33 33 0 0 1 2.5.5m.099 2.54a2 2 0 0 0 .72 3.935c-.333-1.05-.588-2.346-.72-3.935m10.083 3.935a2 2 0 0 0 .72-3.935c-.133 1.59-.388 2.885-.72 3.935"/>
                                    </svg>
                                    {% endif %}
                                </div>
                                
                                <span class="badge badge-primary badge-pill">
                                    {{ "{:.1f}".format(total_hours) }} giờ
                                </span>
                            </li>
                        {% else %}
                            <li class="list-group-item">Chưa có dữ liệu thống kê.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel shadow-sm mb-3">
                <div class="panel-heading bg-secondary text-white p-1 rounded-top">
                    <h3 class="panel-title text-center">Top 10 Khách Hàng</h3>
                </div>
                <div class="panel-body" style="max-height: 500px; overflow-y: scroll;">
                    <ul class="list-group list-group-flush">
                        {% for name, session_count in top_customers %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                
                                <div class="employee-info">
                                    <span class="badge rank-badge">#{{ loop.index }}</span>
                                    <span class="emp-name">{{ name }}</span>
                                    
                                    {% if loop.index == 1 %}
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trophy-fill text-warning" viewBox="0 0 16 16">
                                        <path d="M2.5.5A.5.5 0 0 1 3 0h10a.5.5 0 0 1 .5.5q0 .807-.034 1.536a3 3 0 1 1-1.133 5.89c-.79 1.865-1.878 2.777-2.833 3.011v2.173l1.425.356c.194.048.377.135.537.255L13.3 15.1a.5.5 0 0 1-.3.9H3a.5.5 0 0 1-.3-.9l1.838-1.379c.16-.12.343-.207.537-.255L6.5 13.11v-2.173c-.955-.234-2.043-1.146-2.833-3.012a3 3 0 1 1-1.132-5.89A33 33 0 0 1 2.5.5m.099 2.54a2 2 0 0 0 .72 3.935c-.333-1.05-.588-2.346-.72-3.935m10.083 3.935a2 2 0 0 0 .72-3.935c-.133 1.59-.388 2.885-.72 3.935"/>
                                    </svg>
                                    {% endif %}
                                </div>
                                
                                <span class="badge badge-primary badge-pill">
                                    {{ session_count|int }} lần hát
                                </span>
                            </li>
                        {% else %}
                            <li class="list-group-item">Chưa có dữ liệu thống kê.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<h2 class="text-success text-center">ĐĂNG NHẬP QUẢN TRỊ</h2>

<form method="post" action="/login?next=/admin">
    <div class="form-group">
        <label for="name">Tên đăng nhập:</label>
        <input type="text" class="form-control" placeholder="Tên đăng nhập" id="name" name="username" required/>
    </div>
    <div class="form-group">
        <label for="pwd">Mật khẩu:</label>
        <input type="password" class="form-control" placeholder="Mật khẩu" id="pwd" name="password" required/>
    </div>
    <button type="submit" class="btn btn-primary">Đăng nhập</button>
</form>
{% endif %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<style>
    .card:hover {
        transform: scale(1.05);
        transition: transform 0.2s;
    }

    .navbar {
        background-color: #1a2742 !important;
        border-radius: 8px;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2) !important;
        border-radius: 8px;
    }
</style>
{% endblock %}